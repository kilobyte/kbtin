#!/usr/bin/make -f
export DEB_BUILD_MAINT_OPTIONS=hardening=+all

%:
	dh $@ --parallel --with autoreconf

override_dh_auto_build:
	V=y dh_auto_build
	$(MAKE) manual.html

override_dh_auto_test:
ifeq ($(DEB_BUILD_GNU_TYPE),$(DEB_HOST_GNU_TYPE))
	$(MAKE) check || debian/rules testfail
else
	@echo Suppressing 'make check', because this is a cross build
endif

testfail:
	@echo "!!!TESTS FAILED!!!"
	@cat tests/testsuite.log
	@false

override_dh_auto_install:
	$(MAKE) install DESTDIR=$(CURDIR)/debian/kbtin
	$(MAKE) install-terminfo DESTDIR=$(CURDIR)/debian/kbtin TERMINFODIR=/usr/share/terminfo
	for x in ansi2txt ansi2html ttyrec2ansi pipetty;do \
	  mv $(CURDIR)/debian/kbtin/usr/bin/$$x $(CURDIR)/debian/colorized-logs/usr/bin/; \
        done
	mv $(CURDIR)/debian/kbtin/usr/share/man/man1 $(CURDIR)/debian/colorized-logs/usr/share/man/

override_dh_auto_clean:
	rm -f tests/tests.at
	dh_auto_clean
