AT_SETUP([#showme])
AT_DATA([testin], [#showme abc def ghi
#showme { blah}
#showme ąęść
#var x foo
#showme $x
])
AT_DATA([expout], [abc def ghi
 blah
ąęść
foo
])
AT_CHECK([runtest.sh],,[expout])
AT_CLEANUP


AT_SETUP([no profiling])
AT_DATA([testin], [#rem Profiling should be disabled in release versions.
#profile
])
AT_DATA([expout], [#UNKNOWN TINTIN-COMMAND: [#profile]
])
AT_CHECK([runtest.sh],,[expout])
AT_CLEANUP


AT_SETUP([#reverse])
AT_DATA([testin], [#var x blahąęśćabc
#reverse x $x
#showme $x
])
AT_DATA([expout], [cbaćśęąhalb
])
AT_CHECK([runtest.sh],,[expout])
AT_CLEANUP


AT_SETUP([#postpad])
AT_DATA([testin], [#postpad tmp 5 abcdefgh;#showme {$tmp|}
#postpad tmp 5 abćdęfgh;#showme {$tmp|}
#postpad tmp 5 ab;#showme {$tmp|}
#postpad tmp 5 ać;#showme {$tmp|}
#var x foo
#postpad tmp 5 {a$x};#showme {$tmp|}
#postpad tmp 5 a ć;#showme {$tmp|}
])
AT_DATA([expout], [abcde|
abćdę|
ab   |
ać   |
afoo |
a ć  |
])
AT_CHECK([runtest.sh],,[expout])
AT_CLEANUP

AT_SETUP([#prepad])
AT_DATA([testin], [#prepad tmp 5 abcdefgh;#showme {$tmp|}
#prepad tmp 5 abćdęfgh;#showme {$tmp|}
#prepad tmp 5 ab;#showme {$tmp|}
#prepad tmp 5 ać;#showme {$tmp|}
#var x foo
#prepad tmp 5 {a$x};#showme {$tmp|}
#prepad tmp 5 a ć;#showme {$tmp|}
])
AT_DATA([expout], [defgh|
dęfgh|
   ab|
   ać|
 afoo|
  a ć|
])
AT_CHECK([runtest.sh],,[expout])
AT_CLEANUP

AT_SETUP([#substr])
AT_DATA([testin], [#substr tmp 3 abcde;#showme {$tmp}
#substr tmp 2,3 abcde;#showme {$tmp}
#substr tmp 4,1000 abcde;#showme {$tmp}
#substr tmp 2,4 ąbćdef;#showme {$tmp}
])
AT_DATA([expout], [c
bc
de
bćd
])
AT_CHECK([runtest.sh],,[expout])
AT_CLEANUP

AT_SETUP([late var substitution])
AT_DATA([testin], [#var x A1
#alias foo {#alias bar {#showme $x}}
foo
bar
#var x B1
bar
#var x C1
foo
#var x D1
bar
#var x A2
#alias foo {#alias bar {#showme $$x}}
foo
bar
#var x B2
bar
#var x C2
foo
#var x D2
bar
#var x A3
#alias foo {#alias bar {#showme $$$x}}
foo
bar
#var x B3
bar
#var x C3
foo
#var x D3
bar
])
AT_DATA([expout], [A1
B1
D1
A2
A2
C2
A3
A3
A3
])
AT_CHECK([runtest.sh],,[expout])
AT_CLEANUP

AT_SETUP([#system])
AT_DATA([testin], [#var x abc
#sys echo '$x'
#sys {echo '$x'}
])
AT_DATA([expout], [abc
abc
])
AT_CHECK([runtest.sh],,[expout])
AT_CLEANUP

AT_SETUP([#shell])
AT_DATA([testin], [#shell echo 'abc'
])
AT_DATA([expout], [abc
])
AT_CHECK([runtest.sh],,[expout])
AT_CLEANUP

AT_SETUP([#run])
AT_DATA([testin], [#hook close {#showme FIN;#end}
#run a echo blah
])
AT_DATA([expout], [blah
FIN
])
AT_CHECK([runtest.sh],,[expout])
AT_CLEANUP

AT_SETUP([#run and 16bit Unicode])
AT_DATA([testin], [#hook close {#showme FIN;#end}
#run a echo abcąęśćdefабцдефгхийאבגדァアィイ
])
AT_DATA([expout], [abcąęśćdefабцдефгхийאבגדァアィイ
FIN
])
AT_CHECK([runtest.sh],,[expout])
AT_CLEANUP

AT_SETUP([#goto])
AT_DATA([testin], [#route a b {#showme A>B}
#route b c {#showme B>C}
#goto A B;#showme -=-
#goto a b;#showme -=-
#goto a c;#showme -=-
#route a c {#showme A>C} 5
#goto a c;#showme -=-
#route a c {#showme A>C} 21
#goto a c;#showme -=-
#goto a {};#showme -=-
#goto {} b;#showme -=-
#goto {} {};#showme -=-
a>b;#showme -=-
>c;#showme -=-
#showme ($loc)
])
AT_DATA([expout], [#Location not found: [A]
-=-
A>B
-=-
A>B
B>C
-=-
A>C
-=-
A>B
B>C
-=-
#SYNTAX: #goto <from> <to>
-=-
#SYNTAX: #goto <from> <to>
-=-
#SYNTAX: #goto <from> <to>
-=-
A>B
-=-
B>C
-=-
(c)
])
AT_CHECK([runtest.sh],,[expout])
AT_CLEANUP

AT_SETUP([#end w/o sessions])
AT_DATA([testin], [#end
])
AT_DATA([expout], [])
AT_CHECK([runtest.sh],,[expout])
AT_CLEANUP

AT_SETUP([#end with a session])
AT_DATA([testin], [#run a cat
#end
])
AT_DATA([expout], [
#SESSION 'a' DIED.
])
AT_CHECK([runtest.sh],,[expout])
AT_CLEANUP

AT_SETUP([action priorities])
AT_DATA([testin], [#act {aaa%0} {#showme act: a} {a}
#act {aaa%1} {#showme act: 0} {0}
#act {aaa%2} {#showme act: 0.09} {0.09}
#act {aaa%3} {#showme act: 0.1} {0.1}
#act {aaa%4} {#showme act: 0.10} {0.10}
#act {aaa%5} {#showme act: 0.19} {0.19}
#act {aaa%6} {#showme act: 0a.1} {0a.1}
#act {aaa%7} {#showme act: a06z} {a06z}
#act {aaa%8} {#showme act: a6x} {a6x}
#act {aaa%9} {#showme act: 0.2} {0.2}
#doact aaa
])
AT_DATA([expout], [act: 0
act: 0.1
act: 0.2
act: 0.09
act: 0.10
act: 0.19
act: 0a.1
act: a
act: a6x
act: a06z
])
AT_CHECK([runtest.sh],,[expout])
AT_CLEANUP

AT_SETUP([actions, promptactions])
AT_DATA([testin], [#hook close {#showme FIN;#end}
#act {foo} {#showme <foo>}
#promptact {fo} {#showme <fo...>}
#run a {sh -c "echo -n 'fo';sleep 2;echo 'o'"}
])
AT_DATA([expout], [<fo...>
<fo...>
<foo>
foo
FIN
])
AT_CHECK([runtest.sh],,[expout])
AT_CLEANUP
